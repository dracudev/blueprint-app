<main class="client-setup-card">
<% var formData = typeof formData !== 'undefined' ? formData : {}; %>

<!-- Error Display Section -->
<% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
<div class="alert alert-danger">
  <ul style="margin: 0; padding-left: 20px;">
    <% errors.forEach(function(error) { %>
    <li><%= error.msg || error.message || error %></li>
    <% }); %>
  </ul>
</div>
<% } %>

<form class="crud-form client-setup-form"
      <% if (typeof entityId !== 'undefined' && entityId) { %>
        data-client-id="<%= typeof clientId !== 'undefined' ? clientId : '' %>"
        data-service-id="<%= typeof serviceId !== 'undefined' ? serviceId : '' %>"
        data-project-id="<%= typeof projectId !== 'undefined' ? projectId : '' %>"
        data-entity-id="<%= entityId %>"
      <% } %>
      <% if (typeof entity !== 'undefined') { %>
        data-entity-type="<%= entity %>"
      <% } %>
      data-is-edit="<%= typeof isEdit !== 'undefined' ? isEdit : false %>">
  
  <!-- Hidden fields for entity IDs (fallback for form data) -->
  <% if (typeof clientId !== 'undefined' && clientId) { %>
    <input type="hidden" name="clientId" value="<%= clientId %>" />
  <% } %>
  <% if (typeof serviceId !== 'undefined' && serviceId) { %>
    <input type="hidden" name="serviceId" value="<%= serviceId %>" />
  <% } %>
  <% if (typeof projectId !== 'undefined' && projectId) { %>
    <input type="hidden" name="projectId" value="<%= projectId %>" />
  <% } %>
  
  <!-- Error container for AJAX form errors -->
  <div class="crud-form-errors alert alert-danger" style="display:none"></div>
  
  <% if (typeof fields !== 'undefined' && Array.isArray(fields)) { %>
    <% fields.forEach(function(field) { %>
      <div class="form-group <%= field.fullWidth ? 'full-width' : '' %>">
        <label for="<%= field.name %>"><%= field.label %><%= field.required ? ' *' : '' %></label>
        <% if (field.type === 'textarea') { %>
          <textarea
            id="<%= field.name %>"
            name="<%= field.name %>"
            class="form-control"
            rows="<%= field.rows || 4 %>"
            placeholder="<%= field.placeholder || '' %>"
            <%= field.required ? 'required' : '' %>
            <%= field.readonly ? 'readonly' : '' %>
          ><%= (formData && typeof formData[field.name] !== 'undefined') ? formData[field.name] : '' %></textarea>
        <% } else if (field.type === 'select' && field.name === 'isCompany') { %>
   <div >
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="isCompany" value="false" id="individual"
              <%= (typeof formData !== 'undefined' && formData.isCompany === 'false') ? 'checked' : '' %> />
            <span class="radio-custom" style="display: inline-block;"></span>
            <div class="radio-content">
              <strong>Individual</strong>
              <p>Personal client account</p>
            </div>
          </label>
          <label class="radio-option">
            <input type="radio" name="isCompany" value="true" id="company"
              <%= (typeof formData !== 'undefined' && formData.isCompany === 'true') ? 'checked' : '' %> />
            <span class="radio-custom" style="display: inline-block;"></span>
            <div class="radio-content">
              <strong>Company</strong>
              <p>Business client account</p>
            </div>
          </label>
        </div>
      </div>
        <% } else if (
          (field.name === 'companyName') ||
          (field.name === 'firstName') ||
          (field.name === 'lastName') ||
          (field.name !== 'companyName' && field.name !== 'firstName' && field.name !== 'lastName' && field.type !== 'select')
        ) { %>
          <% if (field.type === 'text' || field.type === 'email' || field.type === 'password' || field.type === 'number') { %>
            <input
              type="<%= field.type || 'text' %>"
              id="<%= field.name %>"
              name="<%= field.name %>"
              class="form-control"
              value="<%= (formData && typeof formData[field.name] !== 'undefined') ? formData[field.name] : '' %>"
              placeholder="<%= field.placeholder || '' %>"
              <%= field.required ? 'required' : '' %>
              <%= field.readonly ? 'readonly' : '' %>
              <%= field.pattern ? 'pattern="' + field.pattern + '"' : '' %>
              <%= field.step ? 'step="' + field.step + '"' : '' %>
              <%= field.min ? 'min="' + field.min + '"' : '' %>
              <%= field.max ? 'max="' + field.max + '"' : '' %>
            />
          <% } %>
        <% } else if (field.type === 'select') { %>
          <select id="<%= field.name %>" name="<%= field.name %>" class="form-control" <%= field.required ? 'required' : '' %>>
            <option value="" disabled <%= (formData && (typeof formData[field.name] === 'undefined' || formData[field.name] === '')) ? 'selected' : '' %>>Select...</option>
            <% (field.options || []).forEach(function(opt) { %>
              <option value="<%= String(opt.value) %>" <%= (formData && String(formData[field.name]) === String(opt.value)) ? 'selected' : '' %>><%= opt.label %></option>
            <% }) %>
          </select>
        <% } else { %>
          <input
            type="<%= field.type || 'text' %>"
            id="<%= field.name %>"
            name="<%= field.name %>"
            class="form-control"
            value="<%= (formData && typeof formData[field.name] !== 'undefined') ? formData[field.name] : '' %>"
            placeholder="<%= field.placeholder || '' %>"
            <%= field.required ? 'required' : '' %>
            <%= field.readonly ? 'readonly' : '' %>
            <%= field.pattern ? 'pattern="' + field.pattern + '"' : '' %>
            <%= field.step ? 'step="' + field.step + '"' : '' %>
            <%= field.min ? 'min="' + field.min + '"' : '' %>
            <%= field.max ? 'max="' + field.max + '"' : '' %>
          />
        <% } %>
        <% if (field.help) { %>
          <small class="form-help"><%= field.help %></small>
        <% } %>
      </div>
    <% }) %>
  <% } %>
  <div class="form-actions">
    <% if (typeof cancelUrl !== 'undefined' && cancelUrl) { %>
      <a href="<%= cancelUrl %>" class="btn btn-secondary">Cancel</a>
    <% } %>
    <button type="submit" class="btn btn-primary">
      <%= typeof submitLabel !== 'undefined' ? submitLabel : (isEdit ? 'Update' : 'Create') %>
    </button>
  </div>
</form>
</main>